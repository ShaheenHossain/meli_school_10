<?xml version="1.0" encoding="UTF-8"?>
<odoo>
    <data>
        <record id="employee_resignation_tree" model="ir.ui.view">
            <field name="name">hr.resignation.tree</field>
            <field name="model">hr.resignation</field>
            <field name="priority" eval="8" />
            <field name="arch" type="xml">
                <tree string="Employee Resignation">
                    <field name="employee_id"/>
                    <field name="department_id"/>
                    <field name="joined_date"/>
                    <field name="expected_revealing_date"/>
                    <field name="approved_revealing_date"/>
                    <!-- <field name="notice_period"/> -->
                </tree>
            </field>
        </record>
        <record id="employee_resignation_form" model="ir.ui.view">
            <field name="name">hr.resignation.form</field>
            <field name="model">hr.resignation</field>
            <field name="priority" eval="8" />
            <field name="arch" type="xml">
                <form string="Employee Resignation">
                    <header>
                        <button string="Confirm" type="object" name="confirm_resignation" states='draft' class="oe_highlight"/>

                        <button string="Send To HOD" type="object" name="requester_action" states="confirm" class="oe_highlight"/>

                        <button string="Interview Schedule" type="object" name="hod_schedule_action" states="hod" class="oe_highlight"/>

                        <button string="Send To HR" type="object" name="hod_action" states="hod_interview" class="oe_highlight"/>

                        <button string="Interview Schedule" type="object" name="hr_schedule_action" states="hr" class="oe_highlight"/>

                        <button string="Send To GM" type="object" name="hr_action" states="hr_interview" class="oe_highlight"/>

                        <button string="Interview Schedule" type="object" name="gm_schedule_action" states="gm" class="oe_highlight"/>

                        <button string="Send to Top Management" type="object" name="gm_action" states="gm,gm_interview" class="oe_highlight"/>

                        <button string="Accepted" type="object" name="top_management_action" states="top_management" class="oe_highlight"/>

                        <button string="retained" type="object" name="retained_action" class="oe_highlight" states="hod_interview,hr_interview,gm_interview"/>

                        <button string="withdrawal" type="object" name="resignation_back" states="approved" class="oe_highlight"/>
   

                        <field name="state" widget="statusbar" statusbar_visible=" draft, confirm, hod, hod_interview, hr, hr_interview, gm, gm_interview, top_management, approved, withdrow"/>

                    </header>
                    <sheet>
                        <div class="oe_title">
                            <h1>
                                <field name="name" readonly="1"/>
                            </h1>
                        </div>
                        <group>
                            <group>
                                <field name="employee_id"/>
                                <field name="department_id"/>
                                <field name="joined_date"/>
                                <field name="resign_confirm_date"/>
                            </group>
                            <group>
                                <field name="expected_revealing_date"/>
                                <field name="approved_revealing_date"/>
                                <field name="notice_period"/>
                                <field name="clearance_form" widget="binary" filename="file_name"/>
                                <field name="file_name" invisible="1"/>

                            </group>
                        </group>
                        <group>
                            <field name="emp_reason"/>
                        </group>
                        <group states="hod,hod_interview,hr,hr_interview,gm,gm_interview,top_management,approved,withdrow">
                            <field name="hod_schedule_date" />
                            <field name="hod_remark" states="hod_interview,hr,hr_interview,gm,gm_interview,top_management,approved,withdrow"/>
                        </group>
                        <group states="hr,hr_interview,gm,gm_interview,top_management,approved,withdrow">
                            <field name="hr_schedule_date" />
                            <field name="hr_remark" states="hr_interview,gm,gm_interview,top_management,approved,withdrow"/>
                        </group>
                        <group  states="gm,gm_interview,top_management,approved,withdrow">
                            <field name="gm_schedule_date"/>
                            <field name="gm_remark" states="gm_interview,top_management,approved,withdrow"/>
                        </group>
                        <notebook>
                            <page string="Clearance Stock">
                                <field name="resignation_ids">
                                    <tree string="Clerance Stock" editable="bottom" create="false" delete="false">
                                        <field name="s_no"/>
                                        <field name="product_id"/>
                                        <field name="quantity"/>
                                        <field name="sequence"/>
                                        <field name="Scheduled_date"/>
                                        <field name="product_type"/>
                                    </tree>
                                </field>
                            </page>
                        </notebook>
                        <!-- <field name="reason"/> -->
                    </sheet>
                    <div class="oe_chatter">
                        <field name="message_follower_ids" widget="mail_followers"/>
                        <field name="message_ids" widget="mail_thread"/>
                    </div>
                </form>
            </field>
        </record>
        <record model="ir.actions.act_window" id="view_employee_resignation">
            <field name="name">Employee Resignation</field>
            <field name="res_model">hr.resignation</field>
            <field name="view_type">form</field>
            <field name="view_mode">tree,form</field>
            <!-- <field name="domain">[('state', 'in', ('draft', 'confirm','hr_approve'))]</field> -->
            <field name="help" type="html">
                <p class="oe_view_nocontent_create">Employee Resignation Form
                </p>
            </field>
        </record>

        <menuitem id="employee_resignation" 
                parent="hr.menu_hr_root" 
                name="Resignation" 
                groups="base.group_user" 
                sequence="21"/>

        <menuitem id="employee_resignation_request" 
                parent="bi_hr.hr_requests_menu_main" 
                name="Resignation Request"
                action="view_employee_resignation"  
                sequence="4"/>

                <!-- groups="base.group_user" -->
    


   <record id="resignation_request_mail" model="mail.template">
            <field name="name">Resignation Request Mail</field>
            <field name="model_id" ref="hr_resignation.model_hr_resignation"></field>
            <field name="email_from"><![CDATA[${object.employee_id.name} <${object.employee_id.work_email}>]]></field>
            <field name="email_to">${object.employee_id.line_manager_id.work_email|safe}</field>
            <field name="subject">Resignation Request Submitted</field>
            <field name="auto_delete" eval="False"/>
            <field name="built_in" eval="True"/>
            <field name="body_html"><![CDATA[
                <p>Dear ${object.employee_id.line_manager_id.name},</p>
                <p>${object.employee_id.name} have submitted resignation request.</p>
                <hr/>    
            ]]>
            </field>
        </record>




        <record id="resign_accepted_ceo_requester" model="mail.template">
            <field name="name">Approved</field>
            <field name="model_id" ref="hr_resignation.model_hr_resignation"></field>
            <field name="email_from">${}</field>
            <field name="email_to">${object.employee_id.work_email|safe}</field>
            <field name="subject">Resignation Approved</field>
            <field name="auto_delete" eval="False"/>
            <field name="built_in" eval="True"/>
            <field name="body_html"><![CDATA[
                <p>Dear ${object.employee_id.name},</p>
                <p>Accepted your resignation.</p>
                <p></p>
                <p></p>
                <p> All The Best</p>
                <hr/>  
            ]]>
            </field>
        </record>


        <record id="resign_accepted_ceo_hr" model="mail.template">
            <field name="name">Approved</field>
            <field name="model_id" ref="hr_resignation.model_hr_resignation"></field>
            <field name="email_from">${}</field>
            <field name="email_to">${object.employee_id.line_manager_id.work_email|safe}</field>
            <field name="subject">${object.employee_id.name} Resign Accepted</field>
            <field name="auto_delete" eval="False"/>
            <field name="built_in" eval="True"/>
            <field name="body_html"><![CDATA[
                <p>Dear ${object.employee_id.line_manager_id.name},</p>
                <p>${object.employee_id.name} resign accepted please do further formalities.</p>
            <p>
            </p>
            <p></p>
            <p> Thankyou</p>
                <hr/> 
            ]]>
            </field>
        </record>

    </data>
</odoo>


